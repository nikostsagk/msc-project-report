%% ----------------------------------------------------------------
%% Introduction.tex
%% ---------------------------------------------------------------- 
\chapter{Introduction} \label{Chapter:Introduction}
The world population is expected to reach 9 billion by the middle of this century. Food production, due to climatic change and land restrictions, among other factors, does not follow this increasing rate (\cite{godfray2010food}). According to \cite{mcguire2015fao}, the rate of undernourished population from 1990 to 2014 was declining (784 million people were undernourished in 2015) and since 2014 is on the rise again (820 million) making apparent the need for securing food. Automation in farms can lower the cost of production and help growers maximise fields' potential, making food accessible to everyone. National Research \cite{NAP5491} defined precision agriculture as a management strategy, which aims to expedite food production by developing decision making and other support systems to help farmers facilitate efficient utilisation of their resources by making use of data gathered with information technologies' techniques. The results of efficient farming, apart from the gains in crop production, can also be measured in terms of invested resources such as labourers, total amounts of water and fertiliser used, thus also reduces the environmental footprint (\cite{zhang2012application}). This thesis aims to investigate the task of apple detection, in the context of general fruit detection, which is groundwork to robotic harvesting.

\section{Motivation}
Fruit counting is a manual process done to estimate crop production and create accurate yield mappings. Usually, it is being done in large orchards under extreme heat and humid conditions, making it a highly intensive and time-consuming labour task. A common farmers' practice to levitate this, is to count the fruit in a small patch of the orchard and then generalise (\cite{bargoti2017fruit}), thus leading in inaccurate results. Other factors such as occlusion by foliage and other fruits or sunlight, contribute to inaccuracy as well.

Furthermore, according to \cite{agro_employment}, there is a continuous decrease in agricultural employment. This seasonal decrease in agro-labour, coupled with the reasons discussed above, further enhance the need for the mechanisation of this process. Therefore, the development of an algorithm that can adequately localise and count fruits in an image is necessary to levitate growers from this task by bringing closer robotic harvesting in agriculture. Besides, accurate detection and counting algorithms can also serve in orchard monitoring and yield mapping by giving continuous measurements about crop production and anticipating pests and diseases.

\section{Problem Formulation and Objectives}
This thesis aims to investigate through the deployment of a deep learning-based object detector framework, how accurately apples can be detected on images under various illuminations and occlusions. Specifically, this project aims to answer the following research question:

\begin{quote}
\centering 
\textit{"How accurately can RetinaNet detect and count the apples on a given RGB dataset taken by monocular cameras?"}
\end{quote}

The contribution to fundamental scientific knowledge in perspective of applications can be achieved within the objectives of the project which are summarised below:

\begin{itemize}
\item \textbf{Deploying and training RetinaNet on the VGG architecture to improve upon the state-of-the-art results.} VGG architecture (\cite{simonyan2014very}) is an architecture based on blocks of increasing receptive field made by stacking $3\times3$ convolutional filters which preserve feature maps' spatial size. This philosophy enables further exploration in lighter models by pruning the main convolutional layers while keeping outputs' size fixed.  
\item \textbf{Identify through systematic experiments the relation between accuracy and the size of the training set.} Deep learning-based methods require large datasets to achieve high performances and generalisation, but such a dataset is in contrast with the motivation of the problem, which is to exempt labourers from doing the labelling task.
\item \textbf{Identify the causes that limit the model's performance.} Apple detection has been tackled with several algorithms on different datasets, thus making comparisons between them impossible. The dataset used in this project, presented through the work of \cite{bargoti2017deep}, has also been used in the work of \cite{liang2018apple}. This dataset has been used many times for fruit detection, but strictly for apple detection through a deep learning approach only by those, yielding similar results. This finding raises questions around the dataset's structure and the factors that limit models' performance.

\end{itemize}

Pre-trained object detectors are already being used thoroughly for agricultural purposes, especially in fruit detection yielding the state-of-the-art results. Faster - RCNN (\cite{ren2015faster}) was the most widely used detector due to its very high mean average precision (mAP) in the general datasets PASCAL-VOC (\cite{everingham2010pascal}) and MS-COCO (\cite{lin2014microsoft}) and has been used repeatedly for apple detection (\cite{sa2016deepfruits}, \cite{bargoti2017deep}, \cite{tao2018rapid}) and for other fruits as well. Faster - RCNN was succeeded in accuracy by RetinaNet (\cite{lin2017focal}) and YOLOv3 (\cite{redmon2018yolov3}) recently giving space for even better results.

\section{Deep Learning in Agriculture}
Image data acquired from cameras can facilitate deep learning techniques, especially convolutional neural networks (CNN) which require spatial 2D inputs (with a depth channel of arbitrary size). \cite{krizhevsky2012imagenet} success of classifying the ImageNet (\cite{deng2009imagenet}) dataset using convolutional neural networks, drew the attention of the agricultural sector. \cite{kamilaris2018deep}, in their recent survey, demonstrated the popularity of deep learning in agriculture by gathering 40 research papers that make use of it and outperform pre-existing methods. Fruit counting is the second most popular area (after weed identification) and 37 out of these 40 papers were published after 2015. 

\subsection{Advantages of Deep Learning}
The success of CNNs is highlighted by the fact that the need for handcrafted features is getting dismissed. Feature engineering is a time-consuming task and not always evident since it requires manual knowledge and effort. \cite{bargoti2016image} approached apple detection in images using a multi-layer perceptron (MLP) in which images were fed along with some metadata ( such as the position of the tree type within the farm and the sun's incidence angle). The gain in performance from metadata was decreasing as the training samples were increasing. 

Furthermore, deep learning models tend to generalise well with large datasets under different types of illumination and occlusions. For example, \cite{rahnemoonfar2017deep} deployed and trained a model entirely with synthetic data while tested it on real samples, for tomato counting with an accuracy of $91\%$. \cite{chen2017counting} built a fruit counting model trained on challenging datasets with high levels of occlusion, uncontrolled illumination and high similarity between fruit colour and foliage. Both models achieved satisfactory generalisation and were robust in occlusion, light conditions and other variations. Training time in Deep Learning models usually takes longer compared to classic approaches (e.g. versus a random forest). However, this is relatively vague since the time a model needs depends on various factors such as resources,  labelling efforts, time spent on optimisation and the depth of the model. A CNN compared with a support vector machine (SVM) is slower to train, but there is a considerable gain in inference time.

\subsection{Disadvantages of Deep Learning}
However, it is worth mentioning some of their drawbacks regarding their training and their results. Very deep models need large datasets to converge, and even acquiring a sufficient dataset size, there should be enough variance among the samples to prevent the model from learning spurious rules and achieve satisfying generalisation. A CNN does not learn anything beyond the expressiveness of the dataset. Data augmentation techniques (artificially increasing the dataset through label preserving transformations) are used in most cases, but there is a generalisation only to a certain extent. Most state-of-the-art deep learning models lack generalising to other datasets making it impossible to compare their results with other methods. Regarding computational resources, CNNs exploit parallel computing maintained by commercial graphic cards (GPU) accelerating their training time on the one hand but require sufficient GPU memory on the other.

%\section{Harvesting System Components}
%\cite{baeten2008autonomous} mention two types of robotic harvesting. The first one is harvesting in \textit{bulk} quantities using machines such as branch shakers, suitable for products like almonds and olives. The second method is suitable for more delicate fruits such as peaches and strawberries, which require more gentle handling. Such an autonomous harvesting system consists of two components \cite{widyartono2019harvesting}): i) the harvesting system and ii) the machine vision system. The machine vision system can be further separated in vision for navigation and vision for fruit detection and localisation (machine vision harvesting). Despite that much work it has been done in each part separately, only the machine vision harvesting system is in the scope of this thesis.

\section{Sensing Modalities}
The sensing device that is used most is a colour CCD camera. Furthermore, deployments can either use monocular cameras or stereo systems. Monocular cameras provide all the advantages a colour camera does, such as colour-based segmentation and texture information, but lack of scale estimation if the distance from the object is not known (\cite{gongal2015sensors}). They are preferred for applications such as fruit detection, fruit counting and structure from motion. However, stereo cameras are capable of depth estimation and are less sensitive under various illuminations; thus, they are preferred (\cite{wang2016localisation}) for yield mapping estimation and 3D reconstruction. Such a deployment is more expensive and limits the system from being a real-time detector.

\section{Related Work in (Deep) Fruit Detection and Counting}
Before deep learning appearance, previous work in fruit detection included heavy use of feature engineering to encode relevant knowledge that could separate fruits from the background. However, feature engineering requires expertise from the domain knowledge, which is not an easy task as the same methods do not apply in all fruits. This lack in generalisation led in developing crop-specific systems in which visual attributes such as colour, shape and texture are being exploited differently for every fruit.

\cite{wang2013automated} developed a system for yield mapping that could count apples by their visual cues in the HSV colour space from images taken under controlled illumination. \cite{pothen2016texture} built a keypoint detector which utilises intensities and gradient orientations on fruit surfaces under conditions of controlled illumination as well. Also, \cite{hung2015feature} developed a system capable of counting red and green apples by segmenting the image in 5 classes (trunk, ground, sky, leaves, fruit) using a conditional random field (CRF). \cite{gongal2015sensors}, in their review, present numerous examples that apply these techniques. Modern fruit detection and counting approaches are mostly deep learning-based as they discarded the need for feature engineering and outperform classical methods. Moreover, they tend to work well with RGB data coming from monocular cameras, thus reducing the need for NIR (near infra-red) (\cite{hung2013orchard}) or other auxiliary data.

The dominant approaches in detection and counting are two; the first one faces detection and counting as a single problem using a deep learning object detection framework. This method has been used extensively with Faster R-CNN (\cite{bargoti2017deep}, \cite{sa2016deepfruits}, \cite{mai2018faster}, \cite{fu2018kiwifruit}, \cite{gene2019multi}) benchmarked under various datasets including mangoes, apples, almonds, sweet peppers and kiwifruits. \cite{liang2018real} used SSD (\cite{liu2016ssd}) to build a real-time detector for mangoes and later on apples (\cite{liang2018apple}). \cite{tian2019apple} and \cite{koirala2019deep} improved the state-of-the-art performance in fruit detection by altering the backbone network of YOLOv3 (\cite{redmon2018yolov3}). This approach detects and counts the fruits in one stage very efficiently, but it is proved that it is insufficient dealing with fruit clusters. 

The second approach, segments the image using a CNN as a blob detector and counts the segmented instances using classical methods such as watershed segmentation (WS) (\cite{beucher1992watershed}), Circular Hough Transformation (CHT) (\cite{atherton1999size}) or Gaussian mixture models (GMM) as seen in \cite{hani2018comparative}, \cite{bargoti2017image} and  \cite{chen2017counting}. It performs better at counting fruits in clusters but is not as accurate as the first method in detection. In addition to this recent work, it is worth mentioning the work of \cite{stein2016image}, who introduced a multi-view approach in order to address occlusion to detect and track fruits using epipolar geometry and GPS information. Similarly, \cite{liu2018robust}, used an FCN (\cite{long2015fully}) to segment 2D sequential images in order to track them across the frames using the Hungarian Algorithm (\cite{kuhn1955hungarian}) with the KLT tracker (\cite{lucas1981iterative}).

